import { Callout } from 'nextra/components';
import { ImageZoom } from 'nextra/components';

# Notification Management

## Background

Notifications are a high-touch feature. Unlike low-visibility background tasks such as model runs and training, notifications are more about user interactions. Each user has different frequency preferences.

Therefore, I separated notifications from the core logic to avoid over-notifying some users.

Now you can integrate notifications into your system with simple settings.

The flow has two main steps:

1. Configure notification sources and targets
2. Configure notification tasks

## Notification source management

![](https://qingyon-revornix-public.oss-cn-beijing.aliyuncs.com/images/20260204183820951.png)

The following sources are supported:

### Email

This source requires configuration. Set `host` and `port` based on your email provider, and fill `username` and `password` with your email account credentials.

```json
{
    "host": "smtp.example.com", 
    "port": 587, 
    "username": "your_email@example.com", 
    "password": "your_password"
}
```

Note: the password here is not your email password. It is the SMTP authorization code. See your email provider's documentation for how to obtain it.

For example, in 163 Mail, you can get the SMTP authorization code by enabling SMTP. A popup will show a string, which is the SMTP authorization code. To use this source, you must enable SMTP.

![](https://qingyon-revornix-public.oss-cn-beijing.aliyuncs.com/images/20251124140427586.png)

### Feishu

This source requires `app_id` and `app_secret`.

```json
{
    "app_id": "cli_a3f3d6a3a3f3d6a3a",
    "app_secret": "dkamsklmlksamkl"
}
```

Because Feishu does not allow direct linking to external files and images in notifications, you need to configure a bot with permission to upload files/images to Feishu. Steps:

1. Go to the [Feishu Developer Console](https://open.feishu.cn/app?lang=zh-CN) and create a custom enterprise app. After creation, open the app details page and copy the app id and app secret into the configuration.
![](https://qingyon-revornix-public.oss-cn-beijing.aliyuncs.com/images/20251124141138428.png)
2. Enable image upload permissions for the app.
![](https://qingyon-revornix-public.oss-cn-beijing.aliyuncs.com/images/20251124141203861.png)

### DingTalk

No configuration is required for this source for now.

### Apple APNS

This source is more complex. See the Apple developer docs: https://developer.apple.com/documentation/usernotifications/sending-notification-requests-to-apns

```json
{
	"team_id": "your team_id",
    "key_id": "your_key_id",
    "private_key": "your_private_key",
    "apns_topic": "your_apns_topic"
}
```

1. Go to the [Apple Developer site](https://developer.apple.com/account) and log in to your Apple developer account.
2. In `Membership details`, you can find your `Team ID`.
3. Go to the [`Certificates, Identifiers & Profiles` page](https://developer.apple.com/account/resources/authkeys/list), create a Key, and set parameters. Enable APNS and set the environment (Production/Sandbox).
![](https://qingyon-revornix-public.oss-cn-beijing.aliyuncs.com/images/20251124155033875.png)
4. On the Key details page you can see the `Key ID`.
![](https://qingyon-revornix-public.oss-cn-beijing.aliyuncs.com/images/20251124155322031.png)
5. Click Download to get the Key file. The file content is the `Private Key`.
6. `apns_topic` is the `Bundle ID` of your app.

### Apple APNS (SandBox)

Same as above, but make sure your `Key` is for the sandbox environment.

### Telegram

This source requires configuration:

```json
{
    "bot_token": "your_bot_token"
}
```

1. Open Telegram and search for `@BotFather` to find the bot creation assistant.
![](https://qingyon-revornix-public.oss-cn-beijing.aliyuncs.com/images/20251124154333723.png)
2. Click Start (skip if already done).
3. Enter `/newbot`.
![](https://qingyon-revornix-public.oss-cn-beijing.aliyuncs.com/images/20251124154316532.png)
4. Follow the prompts to set the bot's name.
![](https://qingyon-revornix-public.oss-cn-beijing.aliyuncs.com/images/20251124154410992.png)
5. Follow the prompts to set the bot's id. The id must be globally unique in Telegram and end with `bot`.
![](https://qingyon-revornix-public.oss-cn-beijing.aliyuncs.com/images/20251124154425825.png)
6. After creation, `BotFather` will return a message with the bot token. Copy it into the configuration.
![](https://qingyon-revornix-public.oss-cn-beijing.aliyuncs.com/images/20251124154540196.png)

## Notification target management

![](https://qingyon-revornix-public.oss-cn-beijing.aliyuncs.com/images/20251124135803397.png)

The following targets are supported:

### Email

This target requires configuration:

```json
{
    "email": "your_email@example.com"
}
```

`email` is the address you want to send notifications to.

### Feishu

This target requires configuration:

```json
{
    "webhook_url": "https://open.feishu.cn/open-apis/bot/v2/hook/xxxxxxxxxxxxxxxxxxxxx",
    "sign": "xxxxxxxxx"
}
```

1. Create a custom webhook bot in a group.
![](https://qingyon-revornix-public.oss-cn-beijing.aliyuncs.com/images/20251124140746854.png)
2. Open the bot configuration details and enable signature.
![](https://qingyon-revornix-public.oss-cn-beijing.aliyuncs.com/images/20251124161144598.png)
3. Copy `Webhook URL` and `signature` into the configuration.

### DingTalk

Same as Feishu above.

### Apple APNS

```json
{
    "device_token": "your_device_token"
}
```

<Callout>This method is for developers. You must have the device's unique ID for your app.</Callout>

To obtain it, configure your app code as follows:

```swift {15}
class AppDelegate: NSObject, UIApplicationDelegate, UNUserNotificationCenterDelegate {
    var window: UIWindow?
    
    func application(_ application: UIApplication,
                     didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {
        registerForRemoteNotifications()
        UNUserNotificationCenter.current().delegate = self
        return true
    }

    func application(_ application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: Data) {
        // If registration succeeds, this function is called
        // Store in UserDefaults
        UserDefaults(suiteName: "group.com.qingyon.Revornix")!.set(deviceToken.hexString, forKey: "device_token")
        print("deviceToken:", deviceToken.hexString)
    }
    
    func application(_ application: UIApplication, didFailToRegisterForRemoteNotificationsWithError error: Error) {
        print("Failed to register for remote notifications: \(error)")
    }

    ...
}
```

### Apple APNS (SandBox)

Same as above.

### Telegram

This target requires configuration:

```json
{
    "chat_id": "your_chat_id"
}
```

1. Create a Telegram group.
2. Invite your Telegram bot to the group.
3. Send a message starting with `/` in the group.
4. Open `https://api.telegram.org/bot[your bot_token]/getUpdates` (replace `[your bot_token]` with your token) and search for the message you just sent.
5. Find the id in the response, copy it, and fill it in the configuration.
![](https://qingyon-revornix-public.oss-cn-beijing.aliyuncs.com/images/20251124162437455.png)

## Notification task management

<Callout>
	Note: notification sources and targets must match, otherwise notifications cannot be sent. See the table below.
</Callout>

| Notification Source | Notification Target |
| :----------------: | :-----------------: |
| Email              | Email               |
| Feishu             | Feishu              |
| DingTalk           | DingTalk            |
| Apple APNS         | Apple APNS          |
| Apple APNS (SandBox) | Apple APNS (SandBox) |
| Telegram           | Telegram            |

![](https://qingyon-revornix-public.oss-cn-beijing.aliyuncs.com/images/20251124135940420.png)

Both time triggers and event triggers are supported. Choose according to your needs.

Currently supported events:

- RemovedFromSection: you were removed from a section
- SectionCommented: a section you created or participated in was commented
- SectionSubscribed: a section you created or participated in was subscribed
- SectionUpdated: a section you participated in or subscribed to was updated

Custom notification content and template content are both supported. If you need real-time messages, you must choose template content because custom content is fixed when you configure it and cannot be updated dynamically.

Available templates:

- Daily Summary Template
- Removed From Section Template
- Section Commented Template
- Section Subscribed Template
- Section Updated Template
