import { Callout } from 'nextra/components';
import { Steps } from 'nextra/components';

# 快速开始

由于当前系统架构设计并非最终版，docker打包仍然有不少问题，因此目前推荐使用手动部署方式。

## 手动部署方式

<Callout>
	强烈建议使用 conda 针对每个服务创建不同的 python 虚拟环境，因为不同服务之间的
	python
	依赖可能存在冲突。当然如果你有别的python虚拟环境管理工具，也可以使用别的。
</Callout>

<Steps>

### 克隆仓库到本地

```shell
git clone git@github.com:Qingyon-AI/Revornix.git
cd Revornix
```

### 安装并且启动基础服务

<Callout>
	如果你没有安装postgres、redis、neo4j、minio、milvus、rsshub、browserless，那么你需要手动在本地安装这些服务，并根据实际需求设置各个服务的环境变量配置，具体参照各服务实际需求和[Revornix环境变量章节](environment)。
	考虑到这些属于比较麻烦且不重要的工作，我特地做了一套`docker-compose-local.yaml`和`.env.local.example`文件，你可以直接使用`docker-compose-local.yaml`这个文件下载这些服务，并使用`.env.local.example`的配置作为环境变量。
</Callout>

<Callout type='warning'>
	注意：如果你本地已经安装了其中的部分服务，请按照你的实际情况在`docker-compose-local.yaml`文件中关闭对应的服务配置，否则可能会引起一些意料之外的情况。
</Callout>

复制我提供的example文件，同时根据实际需求结合[Revornix环境变量章节](environment)修改字段，如果你没有特殊需求，一般只需修改`OAUTH_SECRET_KEY`字段即可。

```shell
cp .env.local.example .env.local
```

启动postgres、redis、neo4j、minio、milvus、rsshub、browserless服务。

```shell
docker compose -f ./docker-compose-local.yaml --env-file .env.local up -d
```

### 各大微服务环境变量配置

```shell
cp ./web/.env.example ./web/.env
cp ./api/.env.example ./api/.env
cp ./celery-worker/.env.example ./celery-worker/.env
```

前往对应的环境变量文件配置，详情见[Revornix环境变量章节](environment)

<Callout type='warning'>
	注意如果你使用手动部署方式，那么不同服务的`SECRET_KEY`必须保持一致，否则会导致不同服务之间的用户认证体系无法互通。
</Callout>

### 初始化一些必要的数据

```shell
cd api
python -m script.init_vector_base_data
python -m script.init_sql_base_data
```

### 启动核心后端服务

```shell
cd api
conda create -n api python=3.11 -y
pip install -r ./requirements.txt
fastapi run --port 8001
```

### 启动热搜聚集服务

```shell
cd daily-hot
pnpm build
pnpm start
```

### 启动 celery 任务序列

```shell
cd celery-worker
conda create -n celery-worker python=3.11 -y
pip install -r ./requirements.txt
celery -A common.celery.app worker --pool=threads --concurrency=10 --loglevel=info -E
```

### 启动前端服务

```shell
cd web
pnpm build
pnpm start
```

</Steps>

当你将所有服务均启动之后，访问 http://localhost:3000 即可看到前端页面
