# Revornix 项目整体架构概览

本文依据当前仓库代码与 `docker-compose.yaml`、各服务 `.env.example` 配置整理。

---

## 1. 系统组件与职责

- Web 前端（Next.js）：用户界面与交互层，入口在 `web`，构建期注入 `NEXT_PUBLIC_*` 变量。  
- API 主后端（FastAPI）：核心业务与数据编排，入口在 `api/main.py`，提供文档、专栏、AI、图谱、通知等接口。  
- Celery Worker：异步与重计算任务处理，入口在 `celery-worker/common/celery/app.py`，负责 embedding、摘要、图谱、播客、通知等。  
- Hot News 服务（Node）：热搜聚合服务，入口在 `hot-news/src/index.ts`，对外提供榜单 API。  
- Nginx（可选）：反向代理与统一入口，配置在 `nginx/nginx.conf`。  
- MCP（内置）：API 内含 MCP 客户端与服务端能力，路由在 `api/mcp_router/*`。  

---

## 2. 数据与基础设施

- PostgreSQL：主业务数据存储，ORM 模型位于 `api/models` 与 `celery-worker/models`。  
- Redis：缓存与任务队列（Celery broker/backend），配置在 `api/config/redis.py` 与 `celery-worker/config/redis.py`。  
- Milvus：向量检索与相似度搜索，配置在 `api/config/milvus.py`。  
- Neo4j：知识图谱存储与查询，配置在 `api/config/neo4j.py`。  
- MinIO（file-backend）：默认文件系统与对象存储，配置由 `FILE_SYSTEM_*` 控制。  
- 可选外部对象存储：支持 AWS S3 / Aliyun OSS / Generic S3，逻辑在 `api/file/*` 与 `celery-worker/file/*`。  

---

## 3. 核心请求与数据流

1. 用户在 Web 发起请求 → API 处理业务逻辑 → 读写 PostgreSQL/Redis/Milvus/Neo4j → 返回响应。  
2. 文档/专栏处理请求 → API 投递任务到 Celery → Worker 执行解析/摘要/向量化/图谱/播客 → 结果入库并通知。  
3. 文件上传/访问 → API 生成文件系统 URL → MinIO 或外部存储读写 → 前端通过公开 URL 访问。  
4. 热搜榜单 → Web 调用 Hot News 服务 → 服务聚合数据并返回列表。  

---

## 4. 部署拓扑（Docker Compose 默认）

- `web`：前端容器，依赖 `api` 与 `file-backend`。  
- `api`：主后端容器，依赖 `postgres`、`redis`、`neo4j`、`milvus`。  
- `celery-worker`：任务处理容器，依赖 `postgres`、`redis`、`neo4j`、`milvus`。  
- `hot-news`：热搜聚合服务。  
- `file-backend`：MinIO 文件系统。  
- `postgres`、`redis`、`neo4j`、`milvus`、`etcd`、`minio`：基础设施组件。  
- `nginx`：统一入口与路由。  
- `rsshub` + `browserless`：RSSHub 抓取与浏览器依赖。  

---

## 5. 可观测与扩展点

- Sentry：API 与 Worker 分别可通过 `API_SENTRY_*`、`WORKER_SENTRY_*` 启用。  
- Langfuse：通过 `LANGFUSE_*` 配置调用链路追踪。  
- 模型提供商扩展：支持多模型与 provider 配置，内置模型能力初始化在 `api/data/sql/create.py`。  
- 第三方登录与短信/邮件：Google/GitHub/WeChat/Tencent SMS/SMTP 均在 API 层集成。  

---

## 6. 初始化与启动流程（简要）

1. 准备 `.env` 与各服务 `.env`。  
2. 启动基础服务（Postgres/Redis/Neo4j/Milvus/MinIO）。  
3. 执行 `api/data/milvus/create` 与 `api/data/sql/create` 初始化数据。  
4. 启动 API、Worker、Web、Hot News。  
